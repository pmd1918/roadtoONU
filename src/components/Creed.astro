<section class="creed-wrap paused">
    <div class="container">
      <span class="creed-line">
        <span class="creed-prefix">I believe in</span>
        <span class="creed-highlight-wrapper">
          <span class="creed-highlight-box"></span>
          <span class="creed-word"></span>
        </span>
        <span class="creed-cursor"></span>
      </span>
    </div>
  </section>

  <style>
    .creed-wrap {
      padding: 3rem 1rem;
      background: linear-gradient(135deg, #212322, #3a3c3b);
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 30vh;
      position: relative;
      overflow: hidden;
    }

    @media (max-width: 768px) {
      .creed-wrap {
        padding: 2rem 0.5rem;
        min-height: 20vh;
      }
    }

    .container {
      max-width: 1200px;
      width: 100%;
      padding: 0 1rem;
    }

    .creed-line {
      display: flex;
      flex-wrap: nowrap;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      font-family: 'Inter', sans-serif;
      text-align: center;
      white-space: nowrap;
    }

    .creed-prefix {
      font-size: clamp(1.2rem, 3.5vw, 3rem);
      font-weight: 300;
      color: #f4f7ff;
      letter-spacing: 0.05em;
    }

    .creed-highlight-wrapper {
      position: relative;
      display: inline-flex;
      align-items: center;
    }

    .creed-highlight-box {
      position: absolute;
      top: 0;
      left: 0;
      bottom: 0;
      width: 0;
      background: linear-gradient(135deg, #ea7600, #f1d44b);
      border-radius: 0.15em;
      z-index: 1;
      transition: width 0.05s ease-out;
    }

    .creed-word {
      position: relative;
      z-index: 2;
      font-size: clamp(1.5rem, 5vw, 4.5rem);
      font-weight: 900;
      color: #212322;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      padding: 0.1em 0.25em;
      display: inline-block;
      line-height: 1.2;
    }

    .creed-word:empty {
      padding: 0;
    }

    .creed-cursor {
      display: inline-block;
      width: 3px;
      height: clamp(1.5rem, 5vw, 4.5rem);
      background-color: #ea7600;
      margin-left: 2px;
      animation: blink-cursor 0.7s step-end infinite;
    }

    .creed-wrap.paused .creed-cursor {
      animation-play-state: paused;
    }

    @keyframes blink-cursor {
      0%, 100% { opacity: 1; }
      50% { opacity: 0; }
    }
  </style>

  <script>
    const words = ['Brotherhood', 'Service', 'Democracy'];
    const wordEl = document.querySelector('.creed-word') as HTMLElement;
    const highlightBox = document.querySelector('.creed-highlight-box') as HTMLElement;
    const section = document.querySelector('.creed-wrap');
    let currentWordIndex = 0;
    let isTyping = false;
    let animationTimeout: number | undefined;

    function updateHighlightWidth() {
      if (highlightBox && wordEl) {
        const width = wordEl.offsetWidth;
        highlightBox.style.width = width > 0 ? width + 'px' : '0';
      }
    }

    async function typeWord(word: string) {
      isTyping = true;
      wordEl.style.color = '#212322';
      
      // Type each character of the word
      for (let i = 0; i <= word.length; i++) {
        if (!isTyping) return;
        wordEl.textContent = word.slice(0, i);
        updateHighlightWidth();
        await new Promise(r => animationTimeout = window.setTimeout(r, 80));
      }
      
      // Pause on complete word
      await new Promise(r => animationTimeout = window.setTimeout(r, 1000));
      
      // Type ellipsis after the word (word + ...)
      for (let i = 1; i <= 3; i++) {
        if (!isTyping) return;
        wordEl.textContent = word + '.'.repeat(i);
        updateHighlightWidth();
        await new Promise(r => animationTimeout = window.setTimeout(r, 150));
      }
      
      // Pause with ellipsis
      await new Promise(r => animationTimeout = window.setTimeout(r, 500));
      
      // Delete ellipsis first
      for (let i = 2; i >= 0; i--) {
        if (!isTyping) return;
        wordEl.textContent = word + '.'.repeat(i);
        updateHighlightWidth();
        await new Promise(r => animationTimeout = window.setTimeout(r, 80));
      }
      
      // Delete the word
      for (let i = word.length; i >= 0; i--) {
        if (!isTyping) return;
        wordEl.textContent = word.slice(0, i);
        updateHighlightWidth();
        await new Promise(r => animationTimeout = window.setTimeout(r, 50));
      }
      
      // Small pause before next word
      await new Promise(r => animationTimeout = window.setTimeout(r, 300));
    }

    async function cycleWords() {
      while (isTyping) {
        await typeWord(words[currentWordIndex]);
        currentWordIndex = (currentWordIndex + 1) % words.length;
      }
    }

    function startCycle() {
      if (!isTyping) {
        isTyping = true;
        cycleWords();
      }
    }

    function stopCycle() {
      isTyping = false;
      if (animationTimeout) {
        clearTimeout(animationTimeout);
        animationTimeout = undefined;
      }
    }

    // Intersection Observer to only animate when visible
    if (section) {
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              section.classList.remove('paused');
              startCycle();
            } else {
              section.classList.add('paused');
              stopCycle();
            }
          });
        },
        { threshold: 0.3 }
      );
      observer.observe(section);
    }
  </script>
