---
const testimonials = [
  {
    image: "/images/avatars/alex-fries.webp",
    name: "Alex Fries",
    title: "National Council member, former chapter president Nu Beta",
    quote: "Joining Phi Mu Delta is about more than joining a chapter. It is about joining a brotherhood of future friends, colleagues and partners in your pursuit of the common good, no matter the arena you choose to enter. Conclave is where that ideal becomes real.",
    color: "#ea7600",
    bgImage: "/images/vintage-flag-bg.webp"
  },
  {
    image: "/images/avatars/1693961796462_orig.webp",
    name: "Michael Doran",
    title: "National Council member, former chapter president Mu Alpha",
    quote: "We spend most of our lives inside our bubbles, in our own built communities. Conclaves are the chance to pop those bubbles and share ideas, successes, failures and support across the national fraternity.",
    color: "#f1d44b",
    bgImage: "/images/fraternity-house-bg.webp"
  },
  {
    image: "/images/avatars/1714137500084.webp",
    name: "Thomas Stephen",
    title: "National Treasurer, former chapter president Nu Beta",
    quote: "Conclave is the expression of our Phi Mu Delta values! Spending time with brothers, old and new, it reminds me of all the good we can create in the world.",
    color: "#ea7600",
    bgImage: "/images/vintage-flag-bg.webp"
  }
];
---

<section class="testimonials-section" id="reviews">
  <div class="testimonials-container">
    <div class="testimonials-header">
      <h2 class="testimonials-title">Why Attend Conclave</h2>
      <p class="testimonials-subtitle">Hear from brothers who've experienced the power of gathering together</p>
    </div>

    <div class="card-wrapper">
      <div class="testimonial-card">
        <div class="slider-track">
          {testimonials.map((t, i) => (
            <div class={`testimonial-slide ${i === 0 ? 'active' : ''}`} data-index={i} data-color={t.color}>
              <div class="slide-layout">
                <div class="photo-section">
                  <div class={`diagonal-bg ${t.bgImage ? 'has-bg-image' : ''}`} data-bg={t.bgImage || ''}>
                    {t.bgImage && <div class="bg-gradient-overlay"></div>}
                  </div>
                  <div class="photo-circle-wrapper">
                    <div class="photo-circle" style={`background: ${t.color};`}>
                      <img src={t.image} alt={t.name} class="photo" loading="lazy" />
                    </div>
                  </div>
                </div>
                <div class="content-section">
                  <div class="quote-decoration">"</div>
                  <blockquote class="quote-text">{t.quote}</blockquote>
                  <div class="author-info">
                    <span class="author-name">{t.name}</span>
                    <span class="author-title">{t.title}</span>
                  </div>
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>

      <div class="nav-arrows">
        <button class="nav-btn nav-prev" aria-label="Previous">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
          </svg>
        </button>
        <button class="nav-btn nav-next" aria-label="Next">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M5 12h14M12 5l7 7-7 7"/>
          </svg>
        </button>
      </div>
    </div>
  </div>
</section>

<style>
  .testimonials-section {
    background: #f4f7ff;
    padding: clamp(0.75rem, 1.5vw, 1rem) clamp(1rem, 2vw, 1.5rem) clamp(2rem, 4vw, 3rem);
  }

  .testimonials-container {
    max-width: 1000px;
    margin: 0 auto;
  }

  .testimonials-header {
    text-align: center;
    margin-bottom: clamp(2rem, 4vw, 3rem);
  }

  .testimonials-title {
    font-family: 'Have Heart', cursive;
    font-size: clamp(2.5rem, 6vw, 4rem);
    color: #ea7600;
    margin-bottom: 0.5rem;
  }

  .testimonials-subtitle {
    font-family: 'Inter', sans-serif;
    font-size: clamp(0.9rem, 2vw, 1.1rem);
    font-weight: 300;
    color: #6b7280;
  }

  .card-wrapper {
    position: relative;
  }

  .testimonial-card {
    background: white;
    border-radius: clamp(16px, 3vw, 24px);
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
    overflow: hidden;
    position: relative;
    min-height: clamp(400px, 50vw, 480px);
  }

  .slider-track {
    position: relative;
    height: 100%;
    min-height: clamp(400px, 50vw, 480px);
  }

  .testimonial-slide {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    transform: translateX(40px);
    transition: all 0.5s ease;
    pointer-events: none;
  }

  .testimonial-slide.active {
    opacity: 1;
    transform: translateX(0);
    pointer-events: auto;
  }

  .slide-layout {
    display: grid;
    grid-template-columns: 0.9fr 1.1fr;
    height: 100%;
    min-height: 480px;
  }

  .photo-section {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: visible;
  }

  .diagonal-bg {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #e8f4fc 0%, #d1e8f5 50%, #c5dff0 100%);
    clip-path: polygon(0 0, 100% 0, 85% 100%, 0% 100%);
  }

  .diagonal-bg.has-bg-image {
    background: var(--bg-image) center/cover no-repeat;
    filter: blur(4px);
  }

  .bg-gradient-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(180deg, rgba(234, 118, 0, 0.35) 0%, rgba(241, 212, 75, 0.35) 100%);
    clip-path: polygon(0 0, 100% 0, 85% 100%, 0% 100%);
  }

  .photo-circle-wrapper {
    position: relative;
    z-index: 2;
    margin-left: -20px;
  }

  .photo-circle {
    width: clamp(160px, 22vw, 260px);
    height: clamp(160px, 22vw, 260px);
    border-radius: 50%;
    padding: clamp(6px, 1vw, 10px);
    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
  }

  .photo {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    object-fit: cover;
    border: clamp(3px, 0.5vw, 5px) solid white;
  }

  .content-section {
    display: flex;
    flex-direction: column;
    justify-content: center;
    padding: clamp(1.5rem, 3vw, 3rem);
    position: relative;
  }

  .quote-decoration {
    font-family: Georgia, serif;
    font-size: clamp(4rem, 8vw, 8rem);
    line-height: 0.8;
    color: #ea7600;
    opacity: 0.25;
    position: absolute;
    top: clamp(0.75rem, 1.5vw, 1.5rem);
    left: clamp(0.5rem, 1vw, 1rem);
    z-index: 0;
  }

  .quote-text {
    font-family: 'Inter', sans-serif;
    font-size: clamp(0.95rem, 1.4vw, 1.05rem);
    font-weight: 400;
    line-height: 1.85;
    color: #4b5563;
    margin-bottom: 2rem;
    position: relative;
    z-index: 1;
  }

  .author-info {
    display: flex;
    flex-direction: column;
    gap: 0.3rem;
  }

  .author-name {
    font-family: 'Have Heart', cursive;
    font-size: clamp(1.5rem, 2.5vw, 2rem);
    color: #212322;
    line-height: 1.2;
  }

  .author-title {
    font-family: 'Inter', sans-serif;
    font-size: clamp(0.7rem, 1.1vw, 0.85rem);
    font-weight: 400;
    color: #9ca3af;
  }

  .nav-arrows {
    display: flex;
    justify-content: center;
    gap: clamp(0.75rem, 1.5vw, 1rem);
    margin-top: clamp(1.5rem, 2.5vw, 2rem);
  }

  .nav-btn {
    width: clamp(40px, 5vw, 52px);
    height: clamp(40px, 5vw, 52px);
    border-radius: 50%;
    background: white;
    border: 1px solid #e5e7eb;
    color: #6b7280;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
  }

  .nav-btn:hover {
    background: #ea7600;
    border-color: #ea7600;
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(234, 118, 0, 0.3);
  }

  @media (max-width: 768px) {
    .slide-layout {
      grid-template-columns: 1fr;
      grid-template-rows: auto 1fr;
    }

    .photo-section {
      padding: 1.5rem 1rem 0.5rem;
      justify-content: center;
    }

    .diagonal-bg {
      clip-path: polygon(0 0, 100% 0, 100% 85%, 0% 100%);
    }

    .bg-gradient-overlay {
      clip-path: polygon(0 0, 100% 0, 100% 85%, 0% 100%);
    }

    .photo-circle-wrapper {
      margin-left: 0;
    }

    .photo-circle {
      width: 140px;
      height: 140px;
    }

    .content-section {
      padding: 1.5rem 2rem 2rem;
      text-align: center;
    }

    .quote-decoration {
      font-size: 3rem;
      top: -0.5rem;
      left: 50%;
      transform: translateX(-50%);
      opacity: 0.15;
    }

    .author-info {
      align-items: center;
    }

    .author-name {
      font-size: 1.75rem;
    }

    .slider-track,
    .testimonial-card {
      min-height: 520px;
    }
    
    .slide-layout {
      min-height: 520px;
    }
  }
</style>

<script>
  // Lazy load background images when testimonials section is in view
  const testimonialsSection = document.querySelector('.testimonials-section');
  if (testimonialsSection) {
    const bgObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          document.querySelectorAll('.diagonal-bg[data-bg]').forEach(el => {
            const bg = el.getAttribute('data-bg');
            if (bg) el.style.setProperty('--bg-image', `url(${bg})`);
          });
          bgObserver.disconnect();
        }
      });
    }, { rootMargin: '200px' });
    bgObserver.observe(testimonialsSection);
  }

  const slides = document.querySelectorAll('.testimonial-slide');
  const prevBtn = document.querySelector('.nav-prev');
  const nextBtn = document.querySelector('.nav-next');
  let current = 0;
  const total = slides.length;

  function showSlide(index) {
    slides.forEach((slide, i) => {
      slide.classList.toggle('active', i === index);
    });
    current = index;
  }

  function nextSlide() {
    showSlide((current + 1) % total);
  }

  function prevSlide() {
    showSlide((current - 1 + total) % total);
  }

  prevBtn?.addEventListener('click', prevSlide);
  nextBtn?.addEventListener('click', nextSlide);

  // Auto-advance every 8 seconds (pause when tab hidden)
  let slideInterval = setInterval(nextSlide, 8000);
  document.addEventListener('visibilitychange', () => {
    if (document.hidden) clearInterval(slideInterval);
    else slideInterval = setInterval(nextSlide, 8000);
  });

  // Touch/swipe support
  let touchStartX = 0;
  const track = document.querySelector('.slider-track');
  
  track?.addEventListener('touchstart', (e) => {
    touchStartX = e.changedTouches[0].screenX;
  }, { passive: true });

  track?.addEventListener('touchend', (e) => {
    const touchEndX = e.changedTouches[0].screenX;
    if (touchStartX - touchEndX > 50) nextSlide();
    if (touchEndX - touchStartX > 50) prevSlide();
  }, { passive: true });
</script>
