---
/**
 * CriticalCSS.astro
 * 
 * Inlines critical above-fold CSS directly in the <head> to prevent
 * render-blocking and FOUC (Flash of Unstyled Content).
 * 
 * This component reads the critical CSS file at build time and embeds it
 * as an inline <style> block. The remaining CSS is loaded asynchronously.
 */
import fs from 'node:fs';
import path from 'node:path';

// Read critical CSS at build time
const criticalCSSPath = path.join(process.cwd(), 'src/styles/critical-inline.css');
let criticalCSS = '';

try {
  criticalCSS = fs.readFileSync(criticalCSSPath, 'utf-8');
  // Minify: remove comments and extra whitespace
  criticalCSS = criticalCSS
    .replace(/\/\*[\s\S]*?\*\//g, '') // Remove comments
    .replace(/\s+/g, ' ')              // Collapse whitespace
    .replace(/\s*([{}:;,])\s*/g, '$1') // Remove space around punctuation
    .replace(/;}/g, '}')               // Remove trailing semicolons
    .trim();
} catch (e) {
  console.warn('Could not read critical CSS file:', e);
}
---

{/* Inline critical CSS - renders immediately, no external request */}
<style is:inline set:html={criticalCSS}></style>
