---
interface Props {
  class?: string;
}
const { class: className = '' } = Astro.props;
---

<section class:list={["centennial-section", className]} id="centennial">
  <div class="fireworks-container">
    <canvas id="fireworks-canvas"></canvas>
  </div>
  
  <div class="centennial-content">
    <h2 class="centennial-headline">
      <span class="headline-main">100 Years of Brotherhood</span>
      <span class="headline-sub">Mu Beta Chapter at Ohio Northern University</span>
    </h2>
    
    <div class="centennial-photos">
      <div class="photo-frame generations">
        <img 
          src="/images/mu-beta-generations.webp" 
          srcset="/images/mu-beta-generations-mobile.webp 308w,
                  /images/mu-beta-generations.webp 800w"
          sizes="(max-width: 768px) 308px, 800px"
          alt="Mu Beta brothers past and present - 1926 founders and current members united at the ONU rock" 
          loading="lazy" 
          width="800" 
          height="528" 
        />
        <div class="photo-caption">1926 â€” 2026: A Century of Brotherhood</div>
      </div>
    </div>
    
    <p class="centennial-description">
      A century of brotherhood, impact and leadership. From 1926 to 2026, 
      the Mu Beta members and alumni have embodied the values 
      of Phi Mu Delta. Join us as we celebrate this historic milestone 
      at the 62nd National Conclave.
    </p>
    
    <div class="centennial-cta">
      <a href="#registration" class="cta-button primary">
        Celebrate With Us
      </a>
    </div>
  </div>
</section>

<style>
  .centennial-section {
    position: relative;
    min-height: 100vh;
    width: 100%;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 2rem 1rem;
    margin-top: -4rem;
    background: #212322;
  }

  @media (min-width: 768px) {
    .centennial-section {
      margin-top: -5rem;
    }
  }
  
  /* Fireworks background */
  .fireworks-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 0;
  }
  
  #fireworks-canvas {
    width: 100%;
    height: 100%;
    display: block;
  }
  
  /* Content overlay */
  .centennial-content {
    position: relative;
    z-index: 10;
    max-width: 1200px;
    width: 100%;
    text-align: center;
    padding: 2rem;
    background: transparent;
  }
  
  @media (max-width: 768px) {
    .centennial-content {
      padding: 1.5rem;
      border-radius: 16px;
    }
  }
  
  /* Badge */
  .centennial-badge {
    display: inline-block;
    margin-bottom: 2rem;
    padding: 0.75rem 2rem;
    background: linear-gradient(135deg, #ea7600, #f1d44b);
    border-radius: 50px;
    box-shadow: 0 4px 20px rgba(234, 118, 0, 0.4);
    animation: pulse 3s ease-in-out infinite;
  }
  
  @media (max-width: 768px) {
    .centennial-badge {
      padding: 0.5rem 1.5rem;
      margin-bottom: 1.5rem;
    }
  }
  
  .badge-text {
    font-family: 'Inter', sans-serif;
    font-size: clamp(1rem, 2vw, 1.5rem);
    font-weight: 900;
    letter-spacing: 0.15em;
    color: #212322;
  }
  
  /* Headline */
  .centennial-headline {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    margin-bottom: 3rem;
  }
  
  @media (max-width: 768px) {
    .centennial-headline {
      margin-bottom: 2rem;
    }
  }
  
  .headline-main {
    font-family: 'Have Heart', cursive;
    font-size: clamp(2.5rem, 8vw, 7rem);
    line-height: 1;
    color: #ea7600;
    white-space: nowrap;
    position: relative;
    z-index: 2;
  }
  
  .headline-sub {
    font-family: 'Inter', sans-serif;
    font-size: clamp(1rem, 2.5vw, 1.75rem);
    font-weight: 300;
    color: #f4f7ff;
    letter-spacing: 0.05em;
    position: relative;
    z-index: 1;
  }
  
  .headline-onu {
    font-family: 'Inter', sans-serif;
    font-size: clamp(2rem, 6vw, 5rem);
    font-weight: 900;
    background: linear-gradient(90deg, #0057b8, #00b7ff);
    background-clip: text;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    text-transform: uppercase;
    letter-spacing: 0.08em;
  }
  
  /* Photos */
  .centennial-photos {
    margin: 3rem auto;
    max-width: 1000px;
    width: 100%;
  }
  
  @media (max-width: 768px) {
    .centennial-photos {
      margin: 2rem auto;
    }
  }
  
  .photo-frame {
    position: relative;
    overflow: hidden;
    background: #1a1a1a;
    border-radius: 4px;
    /* Classic wooden picture frame styling */
    border: 12px solid #3d2b1f;
    border-image: linear-gradient(
      135deg,
      #5c4033 0%,
      #8b6914 15%,
      #4a3728 30%,
      #6b4423 50%,
      #3d2b1f 70%,
      #5c4033 85%,
      #4a3728 100%
    ) 1;
    box-shadow: 
      inset 0 0 0 2px #2a1f15,
      inset 0 0 0 4px #1a1209,
      0 4px 16px rgba(0, 0, 0, 0.5),
      0 8px 32px rgba(0, 0, 0, 0.3);
  }
  
  .photo-frame::before {
    content: '';
    position: absolute;
    inset: 0;
    border: 3px solid rgba(139, 105, 20, 0.3);
    pointer-events: none;
    z-index: 1;
  }
  
  .photo-frame img {
    width: 100%;
    height: auto;
    display: block;
  }
  
  .photo-caption {
    padding: 1rem;
    background: linear-gradient(to top, rgba(33, 35, 34, 0.95), transparent);
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    font-family: 'Inter', sans-serif;
    font-size: 0.875rem;
    font-weight: 600;
    color: #f4f7ff;
    text-align: center;
    letter-spacing: 0.05em;
  }
  
  @media (max-width: 768px) {
    .photo-caption {
      font-size: 0.75rem;
      padding: 0.75rem;
    }
  }
  
  /* Description */
  .centennial-description {
    font-family: 'Inter', sans-serif;
    font-size: clamp(1rem, 2vw, 1.25rem);
    font-weight: 400;
    line-height: 1.8;
    color: #f4f7ff;
    max-width: 800px;
    margin: 2rem auto;
    text-align: center;
  }
  
  @media (max-width: 768px) {
    .centennial-description {
      line-height: 1.6;
      margin: 1.5rem auto;
    }
  }
  
  /* CTA Buttons */
  .centennial-cta {
    display: flex;
    gap: 1.5rem;
    justify-content: center;
    flex-wrap: wrap;
    margin-top: 3rem;
  }
  
  @media (max-width: 768px) {
    .centennial-cta {
      gap: 1rem;
      margin-top: 2rem;
      flex-direction: column;
      align-items: stretch;
    }
  }
  
  .cta-button {
    display: inline-block;
    padding: 1rem 2.5rem;
    font-family: 'Inter', sans-serif;
    font-size: 1.125rem;
    font-weight: 700;
    text-decoration: none;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    border-radius: 50px;
    transition: all 0.3s ease;
    border: 2px solid transparent;
  }
  
  @media (max-width: 768px) {
    .cta-button {
      padding: 0.75rem 1.5rem;
      font-size: 0.9rem;
    }
  }
  
  .cta-button.primary {
    background: linear-gradient(135deg, #ea7600, #f1d44b);
    color: #212322;
    box-shadow: 0 4px 20px rgba(234, 118, 0, 0.4);
  }
  
  .cta-button.primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 32px rgba(234, 118, 0, 0.6);
  }
  
  .cta-button.secondary {
    background: transparent;
    color: #f4f7ff;
    border-color: #f4f7ff;
  }
  
  .cta-button.secondary:hover {
    background: rgba(244, 247, 255, 0.1);
    transform: translateY(-2px);
  }
  
  /* Animations */
  @keyframes pulse {
    0%, 100% {
      transform: scale(1);
    }
    50% {
      transform: scale(1.05);
    }
  }
  
  @keyframes shimmer {
    0% {
      background-position: 200% center;
    }
    100% {
      background-position: -200% center;
    }
  }
</style>

<script>
  (() => {
    const section = document.getElementById('centennial');
    const canvas = document.getElementById('fireworks-canvas') as HTMLCanvasElement | null;
    const ctx = canvas?.getContext('2d');
    if (!section || !canvas || !ctx) return;

    // Colors - orange/gold theme
    const colors = ['#ea7600', '#f1d44b', '#ff9500', '#ffcc00', '#fff', '#ff6b00'];

    interface Particle {
      x: number;
      y: number;
      vx: number;
      vy: number;
      alpha: number;
      color: string;
      decay: number;
      size: number;
    }

    interface Firework {
      x: number;
      y: number;
      vy: number;
      targetY: number;
      color: string;
    }

    const particles: Particle[] = [];
    const fireworks: Firework[] = [];
    const MAX_PARTICLES = 200;
    const reducedMotionQuery = window.matchMedia('(prefers-reduced-motion: reduce)');

    let isSectionVisible = false;
    let isRunning = false;
    let hasLaunchedInitialBurst = false;
    let launchTimer: number | undefined;
    let animationFrameId: number | undefined;

    function resizeCanvas() {
      const bounds = section.getBoundingClientRect();
      canvas.width = Math.max(1, Math.floor(bounds.width));
      canvas.height = Math.max(1, Math.floor(bounds.height));
    }

    function createFirework() {
      if (particles.length >= MAX_PARTICLES) return;
      fireworks.push({
        x: Math.random() * canvas.width,
        y: canvas.height,
        vy: -(8 + Math.random() * 4),
        targetY: 100 + Math.random() * (canvas.height * 0.4),
        color: colors[Math.floor(Math.random() * colors.length)],
      });
    }

    function explode(fw: Firework) {
      const count = 80 + Math.floor(Math.random() * 40);
      for (let i = 0; i < count; i++) {
        if (particles.length >= MAX_PARTICLES) break;

        const angle = (Math.PI * 2 * i) / count + Math.random() * 0.2;
        const speed = 2 + Math.random() * 4;
        particles.push({
          x: fw.x,
          y: fw.y,
          vx: Math.cos(angle) * speed,
          vy: Math.sin(angle) * speed,
          alpha: 1,
          color: Math.random() > 0.3 ? fw.color : colors[Math.floor(Math.random() * colors.length)],
          decay: 0.015 + Math.random() * 0.01,
          size: 2 + Math.random() * 2,
        });
      }
    }

    function drawFrame() {
      if (!isRunning) return;

      ctx.fillStyle = 'rgba(33, 35, 34, 0.15)';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      for (let i = fireworks.length - 1; i >= 0; i--) {
        const fw = fireworks[i];
        fw.y += fw.vy;
        fw.vy += 0.1;

        ctx.beginPath();
        ctx.arc(fw.x, fw.y, 3, 0, Math.PI * 2);
        ctx.fillStyle = fw.color;
        ctx.fill();

        if (fw.y <= fw.targetY || fw.vy >= -1) {
          explode(fw);
          fireworks.splice(i, 1);
        }
      }

      for (let i = particles.length - 1; i >= 0; i--) {
        const particle = particles[i];
        particle.x += particle.vx;
        particle.y += particle.vy;
        particle.vy += 0.05;
        particle.vx *= 0.99;
        particle.alpha -= particle.decay;

        if (particle.alpha <= 0) {
          particles.splice(i, 1);
          continue;
        }

        ctx.beginPath();
        ctx.arc(particle.x, particle.y, particle.size * particle.alpha, 0, Math.PI * 2);
        ctx.fillStyle = particle.color;
        ctx.globalAlpha = particle.alpha;
        ctx.fill();
        ctx.globalAlpha = 1;
      }

      animationFrameId = requestAnimationFrame(drawFrame);
    }

    function runLaunchLoop() {
      if (!isRunning) return;

      createFirework();
      if (Math.random() > 0.5) createFirework();

      launchTimer = window.setTimeout(runLaunchLoop, 800 + Math.random() * 1500);
    }

    function stopAnimation() {
      isRunning = false;

      if (launchTimer !== undefined) {
        clearTimeout(launchTimer);
        launchTimer = undefined;
      }

      if (animationFrameId !== undefined) {
        cancelAnimationFrame(animationFrameId);
        animationFrameId = undefined;
      }
    }

    function startAnimation() {
      if (isRunning) return;
      isRunning = true;

      if (!hasLaunchedInitialBurst) {
        for (let i = 0; i < 3; i++) {
          window.setTimeout(() => {
            if (isRunning) createFirework();
          }, i * 300);
        }
        hasLaunchedInitialBurst = true;
      }

      drawFrame();
      runLaunchLoop();
    }

    function updateAnimationState() {
      const shouldRun = isSectionVisible && !document.hidden && !reducedMotionQuery.matches;
      if (shouldRun) {
        startAnimation();
      } else {
        stopAnimation();
      }
    }

    resizeCanvas();
    window.addEventListener('resize', resizeCanvas, { passive: true });

    const visibilityObserver = new IntersectionObserver(
      (entries) => {
        for (const entry of entries) {
          if (entry.target === section) {
            isSectionVisible = entry.isIntersecting;
            updateAnimationState();
          }
        }
      },
      { threshold: 0.1 }
    );
    visibilityObserver.observe(section);

    document.addEventListener('visibilitychange', updateAnimationState);

    if (typeof reducedMotionQuery.addEventListener === 'function') {
      reducedMotionQuery.addEventListener('change', updateAnimationState);
    } else if (typeof reducedMotionQuery.addListener === 'function') {
      reducedMotionQuery.addListener(updateAnimationState);
    }
  })();
</script>
